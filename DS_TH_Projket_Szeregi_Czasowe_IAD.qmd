---
title: "IAD Szeregi Czasowe - Projekt Końcowy"
author: "Damian Spodar & Tomasz Hanusek gc1"
format: 
   pdf:
    fontsize: 9pt
editor: visual
---

# Analiza Szeregów Czasowych dla cen akcji Chevron oraz Valero Energy

### Cel Projektu

Celem projektu jest analiza szeregów czasowych cen akcji spółek energetycznych Chevron (CVX) oraz Valero Energy (VLO). Analiza pozwala zrozumieć zachowanie cen w okresie od początku 2022 roku, zweryfikować charakter trendu (deterministyczny vs. stochastyczny) oraz porównać dynamikę dwóch dużych spółek sektora energetycznego. Kluczowym elementem jest budowa modelu prognostycznego klasy ARIMA poprzedzona weryfikacją stacjonarności.

### Krótki opis spółek

Chevron (CVX):

:   *Amerykańska spółka z branży energetycznej, zajmująca się wydobyciem, rafinacją i sprzedażą ropy naftowej oraz gazu ziemnego. Chevron należy do największych producentów energii na świecie, a jego akcje są notowane na giełdzie NYSE. Firma charakteryzuje się stabilną obecnością w sektorze upstream i downstream oraz znaczącym udziałem w globalnym rynku ropy.*

Valero Energy (VLO):

:   *Amerykańska spółka rafineryjna i dystrybutor paliw, koncentrująca się na przetwórstwie ropy naftowej i produkcji paliw, w tym benzyny, oleju napędowego i biopaliw. Valero posiada rafinerie w Stanach Zjednoczonych i Kanadzie, a jej akcje są również notowane na giełdzie NYSE. Firma jest jednym z największych niezależnych producentów paliw na świecie i charakteryzuje się dużą zmiennością przychodów ze względu na wahania cen ropy i popytu na paliwa.*

### Użyte biblioteki

```{r message=FALSE, warning=FALSE, echo=TRUE}
library(quantmod)
library(forecast)
library(tseries)
library(lmtest)
library(FinTS)
library(rugarch)
```

\pagebreak

# Chevron

### Pobranie danych

Dane cen akcji Chevron (CVX) pobrano z serwisu Yahoo Finance w okresie od 01.01.2022 do 20.01.2026. Do analizy wykorzystano ceny zamknięcia (Close), które są standardem w badaniach finansowych i dobrze odzwierciedlają codzienne wahania wartości akcji. Dodatkowo obliczono logarytmiczne stopy zwrotu, które ułatwiają modelowanie zmienności i stosowanie modeli ARIMA.

```{r, echo= FALSE, message=FALSE, warning=FALSE,fig.show="hide"}
getSymbols("CVX", src = "yahoo", from = "2022-01-01", to = "2026-01-21")


prices <- Cl(CVX) # ceny zamknięcia
returns <- diff(log(prices))[-1] # log‑stopy zwrotu
plot(prices, type="l", main="Ceny akcji Chevron (CVX)")
t <- 1:length(prices)
```

## Analiza trendu - wybór stopnia wielomianu przez AIC

W pierwszym kroku podjęto próbę opisu szeregu za pomocą deterministycznego modelu trendu wielomianowego. Do wyboru najlepszego modelu wykorzystano kryterium informacyjne Akaike (AIC).

Uzyskane wartości AIC dla kolejnych stopni wielomianu były następujące:

```{r,echo= FALSE}
AIC_values <- c()
models <- list()


for (i in 1:10) {
model <- lm(prices ~ poly(t, i, raw=TRUE))
AIC_values[i] <- AIC(model)
models[[i]] <- model
}

cat("Wartości AIC dla kolejnych stopni wielomianu:\n")
print(AIC_values)

best_degree <- which.min(AIC_values)
cat("\nNajlepszy stopień wielomianu wg AIC:", best_degree, "\n")

best_model <- models[[best_degree]]
lines(fitted(best_model), col="red", lwd=3)
```

**Wnioski i krytyka podejścia**: Najniższą wartość AIC uzyskano dla wielomianu 10. stopnia. Choć matematycznie model ten najlepiej dopasowuje się do danych historycznych, w kontekście finansowym wskazuje to na zjawisko "przeuczenia" (overfitting). Ceny akcji zazwyczaj charakteryzują się trendem stochastycznym (błądzenie losowe), a nie deterministycznym. Wysoki stopień wielomianu próbuje na siłę opisać losowe fluktuacje jako stałe prawo, co zweryfikujemy badając reszty tego modelu.

# Analiza sezonowości

Sezonowość została zbadana za pomocą dekompozycji:

```{r,echo= FALSE}
price_series <- as.numeric(prices$CVX.Close)
decomp <- stl(ts(price_series, frequency = 252), s.window = "periodic")
plot(decomp)
```

Analiza wykresów dekompozycji wskazuje, że dominującą strukturę szeregu stanowi trend, natomiast składnik sezonowy jest stosunkowo niewielki. Oznacza to, że w analizowanym okresie ceny akcji Chevron nie wykazują wyraźnej powtarzalnej sezonowości, co jest charakterystyczne dla dziennych danych giełdowych.

## Analiza reszt modelu trendu

Reszty najlepszego modelu trendu zostały poddane testowi Ljunga–Boxa, który sprawdza, czy isnieje autokorelacja reszt:

```{r,echo= FALSE}
residuals_trend <- residuals(best_model)

acf(residuals_trend, main="ACF reszt modelu wielomianowego")
Box.test(residuals_trend, lag=20, type="Ljung-Box")
```

Test Ljunga–Boxa dla reszt modelu trendu wykazuje $\text{p-value} < 2.2 \times 10^{−16}$. Odrzucamy hipotezę zerową o braku autokorelacji.\
**Wniosek**: Reszty nie są białym szumem. Oznacza to, że model deterministyczny (wielomian) nie wyjaśnia dynamiki szeregu. Szereg prawdopodobnie jest niestacjonarny i wymaga podejścia stochastycznego (ARIMA).

## Badanie stacjonarności (Test ADF)

Przed zastosowaniem modeli ARIMA, należy formalnie zbadać stacjonarność szeregu za pomocą Rozszerzonego Testu Dickeya-Fullera (ADF).\

Hipotezy:\
$H_0$: Szereg jest niestacjonarny (posiada pierwiastek jednostkowy).\
$H_1$: Szereg jest stacjonarny.

```{r,echo= FALSE}
# Test dla surowych cen
adf_prices <- adf.test(prices)
print(adf_prices)

# Test dla pierwszych różnic (log-zwroty)
adf_returns <- adf.test(returns)
print(adf_returns)
```

Interpretacja:\

 1. Dla cen surowych p-value $\le$ 0.01, co pozwala przyjąć $H_1$. Szereg jest stacjonarny.\
 2. Dla log-stóp zwrotu (pierwsze różnice) p-value $\le$ 0.01, co pozwala przyjąć $H_1$.\
 
**Konkluzja**: Szereg jest zintegrowany w stopniu pierwszym (I(1)), co uzasadnia przyjęcie parametru d=1 w modelu ARIMA.

## Modelowanie stochastyczne - ARIMA

```{r,echo= FALSE}
auto_arima <- auto.arima(prices)
summary(auto_arima)
checkresiduals(auto_arima)
```

Dopasowano model **ARIMA(0,1,0),** który najlepiej opisuje strukturę szeregu po uwzględnieniu trendu.

Model ARIMA(0,1,0) to tzw. Błądzenie Losowe (Random Walk). Można go zapisać równaniem: $Y_t = Y_{t-1} + \epsilon_t$, gdzie $\epsilon_t$ to biały szum. Oznacza to, że najlepszą prognozą ceny na jutro jest cena dzisiejsza, a zmiany cen są nieprzewidywalne. Jest to zgodne z Hipotezą Rynku Efektywnego (EMH) w jej słabej formie.

Jakość dopasowania oceniono za pomocą błędów prognozy (RMSE = 2.535, MAE = 1.838) oraz testu Ljunga–Boxa na resztach modelu:

`Q* = 6.6771, df = 10, p-value = 0.7555`

Wysoka wartość p-value w teście Ljunga–Boxa oznacza, że reszty modelu ARIMA nie wykazują istotnej autokorelacji, co świadczy o poprawnym dopasowaniu modelu. Model ten skutecznie uchwycił zależności czasowe w średniej szeregu, umożliwiając dalszą analizę zmienności i potencjalne prognozy cen.

### Podsumowanie:

Ceny akcji Chevron w okresie od początku 2022 roku wykazały silny, nieliniowy trend, najlepiej opisany przez wielomian 10. stopnia. Reszty modelu trendu wykazywały istnienie autokorelacji, co uzasadniało zastosowanie modelu ARIMA(0,1,0). Dopasowany model dobrze uchwycił zależności czasowe, a reszty nie wykazywały istotnej autokorelacji, co potwierdził test Ljunga–Boxa.

\pagebreak

# Valero Energy

### Pobranie danych

Dane cen akcji Valero Energy (VLO) pobrano z serwisu Yahoo Finance w okresie od 01.01.2022 do 20.01.2026. Do analizy wykorzystano ceny zamknięcia (Close), które są standardem w badaniach finansowych i dobrze odzwierciedlają codzienne wahania wartości akcji. Dodatkowo obliczono logarytmiczne stopy zwrotu, które ułatwiają modelowanie zmienności i stosowanie modeli ARIMA.

```{r, echo= FALSE, message=FALSE, warning=FALSE,fig.show="hide"}
getSymbols("VLO", src = "yahoo", from = "2022-01-01", to = "2026-01-21")


prices <- Cl(VLO) # ceny zamknięcia
returns <- diff(log(prices))[-1] # log‑stopy zwrotu
plot(prices, type="l", main="Ceny akcji Valero Energy (VLO)")
t <- 1:length(prices)
```

## Analiza trendu - wybór stopnia wielomianu przez AIC

W pierwszym kroku podjęto próbę opisu szeregu za pomocą deterministycznego modelu trendu wielomianowego. Do wyboru najlepszego modelu wykorzystano kryterium informacyjne Akaike (AIC).

Uzyskane wartości AIC dla kolejnych stopni wielomianu były następujące:

```{r,echo= FALSE}
AIC_values <- c()
models <- list()


for (i in 1:10) {
model <- lm(prices ~ poly(t, i, raw=TRUE))
AIC_values[i] <- AIC(model)
models[[i]] <- model
}

cat("Wartości AIC dla kolejnych stopni wielomianu:\n")
print(AIC_values)

best_degree <- which.min(AIC_values)
cat("\nNajlepszy stopień wielomianu wg AIC:", best_degree, "\n")

best_model <- models[[best_degree]]
lines(fitted(best_model), col="blue", lwd=3)
```

**Wnioski i krytyka podejścia**: Najniższą wartość AIC uzyskano dla wielomianu 10. stopnia. Choć matematycznie model ten najlepiej dopasowuje się do danych historycznych, w kontekście finansowym wskazuje to na zjawisko "przeuczenia" (overfitting). Ceny akcji zazwyczaj charakteryzują się trendem stochastycznym (błądzenie losowe), a nie deterministycznym. Wysoki stopień wielomianu próbuje na siłę opisać losowe fluktuacje jako stałe prawo, co zweryfikujemy badając reszty tego modelu.

# Analiza sezonowości

Sezonowość została zbadana za pomocą dekompozycji:

```{r,echo= FALSE}
price_series <- as.numeric(prices$VLO.Close)
decomp <- stl(ts(price_series, frequency = 252), s.window = "periodic")
plot(decomp)
```

Analiza wykresów dekompozycji wskazuje, że dominującą strukturę szeregu stanowi trend, natomiast składnik sezonowy jest stosunkowo niewielki. Oznacza to, że w analizowanym okresie ceny akcji Valero Energy nie wykazują wyraźnej powtarzalnej sezonowości, co jest charakterystyczne dla dziennych danych giełdowych.

## Analiza reszt modelu trendu

Reszty najlepszego modelu trendu zostały poddane testowi Ljunga–Boxa, który sprawdza, czy isnieje autokorelacja reszt:

```{r,echo= FALSE}
residuals_trend <- residuals(best_model)

acf(residuals_trend, main="ACF reszt modelu wielomianowego")
Box.test(residuals_trend, lag=20, type="Ljung-Box")
```

Test Ljunga–Boxa dla reszt modelu trendu wykazuje $\text{p-value} < 2.2 \times 10^{−16}$. Odrzucamy hipotezę zerową o braku autokorelacji.\
**Wniosek**: Reszty nie są białym szumem. Oznacza to, że model deterministyczny (wielomian) nie wyjaśnia dynamiki szeregu. Szereg prawdopodobnie jest niestacjonarny i wymaga podejścia stochastycznego (ARIMA).

## Badanie stacjonarności (Test ADF)

Przed zastosowaniem modeli ARIMA, należy formalnie zbadać stacjonarność szeregu za pomocą Rozszerzonego Testu Dickeya-Fullera (ADF).\

Hipotezy:\
$H_0$: Szereg jest niestacjonarny (posiada pierwiastek jednostkowy).\
$H_1$: Szereg jest stacjonarny.

```{r,echo= FALSE}
# Test dla surowych cen
adf_prices <- adf.test(prices)
print(adf_prices)

# Test dla pierwszych różnic (log-zwroty)
adf_returns <- adf.test(returns)
print(adf_returns)
```

Interpretacja:\

 1. Dla cen surowych p-value > 0.05, co oznacza brak podstaw do odrzucenia $H_0$. Szereg jest niestacjonarny.\
 2. Dla log-stóp zwrotu (pierwsze różnice) p-value $\le$ 0.01, co pozwala przyjąć $H_1$.\
 
**Konkluzja**: Szereg jest zintegrowany w stopniu pierwszym (I(1)), co uzasadnia przyjęcie parametru d=1 w modelu ARIMA.

## Modelowanie stochastyczne - ARIMA

```{r,echo= FALSE}
auto_arima <- auto.arima(prices)
summary(auto_arima)
checkresiduals(auto_arima)
```

Dopasowano model **ARIMA(0,1,0),** który najlepiej opisuje strukturę szeregu po uwzględnieniu trendu.

Model ARIMA(0,1,0) to tzw. Błądzenie Losowe (Random Walk). Można go zapisać równaniem: $Y_t = Y_{t-1} + \epsilon_t$, gdzie $\epsilon_t$ to biały szum. Oznacza to, że najlepszą prognozą ceny na jutro jest cena dzisiejsza, a zmiany cen są nieprzewidywalne. Jest to zgodne z Hipotezą Rynku Efektywnego (EMH) w jej słabej formie.

Jakość dopasowania oceniono za pomocą błędów prognozy (RMSE = 3.021, MAE = 2.246) oraz testu Ljunga–Boxa na resztach modelu:

`Q* = 1.2448, df = 10, p-value = 0.9995`

Wysoka wartość p-value w teście Ljunga–Boxa oznacza, że reszty modelu ARIMA nie wykazują istotnej autokorelacji, co świadczy o poprawnym dopasowaniu modelu. Model ten skutecznie uchwycił zależności czasowe w średniej szeregu, umożliwiając dalszą analizę zmienności i potencjalne prognozy cen.

### Podsumowanie

Ceny akcji Valero Energy również wykazały nieliniowy trend, najlepiej opisany przez wielomian 10. stopnia. Sezonowość była słaba, a reszty trendu nie były losowe, co uzasadniało zastosowanie ARIMA(0,1,0). Dopasowany model dobrze uchwycił dynamikę średniego poziomu cen, a reszty nie wykazały autokorelacji (p-value w teście Ljunga–Boxa równe 0.9995), co potwierdza poprawność modelu.
